"use strict";angular.module("site",["ui.router","ui.bootstrap","ngConfirm"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}).state("demo1",{url:"/demo1",templateUrl:"app/demo1/demo.html",controller:"Demo1Ctrl"}).state("demo2",{url:"/demo2",templateUrl:"app/demo2/demo.html",controller:"Demo2Ctrl"}),t.otherwise("/")}]),angular.module("site").controller("MainCtrl",["$scope",function(e){e.awesomeThings=[]}]),angular.module("site").controller("Demo1Ctrl",["$scope","$filter",function(e,t){e.startDate="",e.endDate="",e.format="EEE dd-MMM-yyyy",e.open=function(t,n){t.preventDefault(),t.stopPropagation(),"start"===n?e.stateOpened=!0:e.endOpened=!0},e.validDates=!1,e.checkDates=function(){if(e.startDate<=e.endDate){e.validDates=!0;for(var n=e.startDate.getTime()-e.startDate.getMilliseconds(),o=864e5,i=e.endDate.getTime()-e.endDate.getMilliseconds();i>=n;n+=o)e.dayRecords.push(new a(t("date")(new Date(n),"EEE dd-MMM-yyyy")))}},e.getStateJSON=function(){var t={startDate:e.startDate,endDate:e.endDate,dayRecords:e.dayRecords};return JSON.stringify(t)},e.loadFromFile=function(t){var n=JSON.parse(t);null!==n&&(e.startDate=n.startDate,e.endDate=n.endDate,e.dayRecords=n.dayRecords,e.validDates=!0)},e.downloadFile=function(){var n=e.getStateJSON(),o=t("date")(e.startDate,"dd-MMM-yyyy"),a=t("date")(e.endDate,"dd-MMM-yyyy"),i=o+"_"+a+".demo1.bkr",c=document.createElement("a");c.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),c.setAttribute("download",i),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)},e.autoSaveLocalStorage=function(){};var n=function(){return{date:"",name:"",price:0,checked:!0}},o=function(e){var t={name:e,incomeItems:[new n],expenseItems:[new n]};return t};e.addIncomeItem=function(e){e.incomeItems.push(new n)},e.addExpenseItem=function(e){e.expenseItems.push(new n)},e.totalIncome=function(e){var t,n=0;for(t in e.incomeItems){var o=e.incomeItems[t];o.checked&&(n+=Number(o.price))}return n},e.totalExpense=function(e){var t,n=0;for(t in e.expenseItems){var o=e.expenseItems[t];o.checked&&(n+=Number(o.price))}return n},e.totalBalance=function(t){return e.totalIncome(t)-e.totalExpense(t)};var a=function(e){return{name:e,groups:[new o("Eat-in Cash"),new o("Delivery Cash"),new o("Just Eat Cash"),new o("Eat-in Card"),new o("Delivery Card"),new o("Just Eat Card"),new o("Eat-in Cheque"),new o("Delivery Cheque"),new o("Other")]}};e.dayRecords=[]}]).directive("onReadFile",["$parse",function(e){return{restrict:"A",scope:!1,link:function(t,n,o){var a=e(o.onReadFile);n.on("change",function(e){var n=new window.FileReader;n.onload=function(e){t.$apply(function(){a(t,{$fileContent:e.target.result})})},n.readAsText((e.srcElement||e.target).files[0])})}}}]).filter("groupTotalIncome",function(){return function(e,t){return t.totalIncome(e)}}).filter("dayTotalIncome",function(){return function(e,t){var n,o=0;for(n in e.groups){var a=e.groups[n];o+=t.totalIncome(a)}return o}}).filter("groupTotalExpense",function(){return function(e,t){return t.totalExpense(e)}}).filter("dayTotalExpense",function(){return function(e,t){var n,o=0;for(n in e.groups){var a=e.groups[n];o+=t.totalExpense(a)}return o}}).filter("groupTotalBalance",function(){return function(e,t){return t.totalBalance(e)}}).filter("dayTotalBalance",function(){return function(e,t){var n,o=0;for(n in e.groups){var a=e.groups[n];o+=t.totalBalance(a)}return o}}),angular.module("site").controller("Demo2Ctrl",["$scope","$filter","$timeout",function(e,t,n){function o(){for(var e=[],t="0123456789abcdef",n=0;36>n;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var o=e.join("");return o}e.itemsTabActive=!0,e.keyDown=function(t,o){if(t.altKey&&65===t.keyCode){t.preventDefault(),e.addItem();var a="body > div.ng-scope > div > div.ng-isolate-scope > div > div.tab-pane.ng-scope.active > div:nth-child("+(o+1)+") > div.col-md-2 > div > input";n(function(){$(a).focus()},500)}},e.format="EEE dd-MMM-yyyy",e.datePickerOpenedItems={},e.lastDateInput=t("date")(new Date,"EEE dd-MMM-yyyy"),e.lastItemGroupInput="Other",e.lastItemTypeInput="Other",e.updateLastDateInput=function(n){var o=e.items[n].date,a=t("date")(new Date(o),"EEE dd-MMM-yyyy");e.items[n].date=a,e.lastDateInput=a},e.updateLastItemGroupInput=function(t){var n=e.items[t].itemGroup;e.lastItemGroupInput=n},e.updateLastItemTypeInput=function(t){var n=e.items[t].itemType;e.lastItemTypeInput=n},e.open=function(t,n){t.preventDefault(),t.stopPropagation(),e.datePickerOpenedItems[n]=!0},e.deleteItem=function(t){var n;for(n in e.items.ids)if(e.items.ids[n]===t){e.items.ids.splice(n,1),delete e.items[t];break}console.log(e.items)},e.getStateJSON=function(){var t={items:e.items,uncheckedItems:e.uncheckedItems};return JSON.stringify(t)},e.loadFromFile=function(t){var n=JSON.parse(t);null!==n&&(e.items=n.items,e.uncheckedItems=n.uncheckedItems)},e.downloadFile=function(){var n=e.getStateJSON(),o=t("date")(new Date,"dd-MMM-yyyy_HH_mm_ss")+".demo2.bkr",a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),a.setAttribute("download",o),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},e.autoSaveLocalStorage=function(){};var a=function(){return{id:o(),date:t("date")(new Date(e.lastDateInput),"EEE dd-MMM-yyyy"),name:"",itemType:e.lastItemTypeInput,itemGroup:e.lastItemGroupInput,price:0}};e.statement={itemTypes:["Income","Expense","Other"],itemGroups:["Eat-in Cash","Delivery Cash","Just Eat Cash","Eat-in Card","Delivery Card","Just Eat Card","Eat-in Cheque","Delivery Cheque","Other"]},e.items={ids:[]},e.uncheckedItems={},e.addItem=function(){var t=new a;e.items[t.id]=t,e.datePickerOpenedItems[t.id]=!1,e.items.ids.push(t.id)},e.toggleItemCheck=function(t){e.uncheckedItems[t]?delete e.uncheckedItems[t]:e.uncheckedItems[t]=!0}}]).filter("itemDays",function(){return function(e){var t=0,n=[];for(t in e.ids){var o=e[e.ids[t]].date;-1===n.indexOf(o)&&n.push(o)}return n.sort(function(e,t){return new Date(e)-new Date(t)})}}).filter("dayTotal",["numberFilter",function(e){return function(t,n,o,a){var i=0,c=0,s=0,d=0;for(i in t.ids){var l=t[t.ids[i]];l.date===n&&l.itemType===o&&(a.uncheckedItems[l.id]||(c++,d+=Number(l.price)),s++)}return"("+c+"/"+s+"): "+e(d,2)}}]).filter("groupTotal",["numberFilter",function(e){return function(t,n,o,a,i){var c=0,s=0,d=0,l=0;for(c in t.ids){var r=t[t.ids[c]];r.date===n&&r.itemGroup===o&&r.itemType===a&&(i.uncheckedItems[r.id]||(s++,l+=Number(r.price)),d++)}return"("+s+"/"+d+"): "+e(l,2)}}]).filter("groupItem",function(){return function(e,t,n,o){var a=0,i=[];for(a in e.ids){var c=e[e.ids[a]];c.date===t&&c.itemGroup===n&&c.itemType===o&&i.push(c)}return i}}).filter("weekOfTime",function(){return function(e){var t=6048e5,n=9467712e5;return Math.floor((e-n)/t)}}).filter("itemWeekDays",["weekOfTimeFilter",function(e){return function(t,n){var o=0,a=[];for(o in t.ids){var i=t[t.ids[o]].date;e(new Date(i))===n&&-1===a.indexOf(i)&&a.push(i)}return a.sort(function(e,t){return new Date(e)-new Date(t)})}}]).filter("weeksOfItems",["weekOfTimeFilter",function(e){return function(t){var n,o=[];for(n in t.ids){var a=t[t.ids[n]].date,i=new Date(a).getTime(),c=e(i);-1===o.indexOf(c)&&o.push(c)}return o.sort()}}]).filter("weekDateRange",["dateFilter",function(e){return function(t){var n=6048e5,o=n*t-3456e5,a=n*(t+1)-432e6,i="EEE dd-MMM-yyyy";return e(new Date(o),i)+" - "+e(new Date(a),i)}}]).filter("itemsInWeek",["weekOfTimeFilter",function(e){return function(t,n){var o,a=[];for(o in t.ids){var i=t[t.ids[o]].date,c=new Date(i).getTime(),s=e(c);s===n&&a.push(t.ids[o])}return a}}]).filter("weekTotal",["numberFilter","weekOfTimeFilter",function(e,t){return function(n,o,a,i){var c=0,s=0,d=0,l=0;for(c in n.ids){var r=n[n.ids[c]],p=r.date,m=new Date(p).getTime(),u=t(m);u===o&&r.itemType===a&&(i.uncheckedItems[r.id]||(s++,l+=Number(r.price)),d++)}return"("+s+"/"+d+"): "+e(l,2)}}]).filter("weekItems",["weekOfTimeFilter",function(e){return function(t,n,o){var a,i=[];for(a in t.ids){var c=t[t.ids[a]],s=c.date,d=new Date(s).getTime(),l=e(d);l===n&&c.itemType===o&&i.push(c)}return i}}]),angular.module("site").run(["$templateCache",function(e){e.put("app/demo1/demo.html",'<div class="container"><div class="row" ng-show="!validDates"><div class="col-md-6">Start Date</div><div class="col-md-6">End Date</div><div class="col-md-6"><p class="input-group"><input type="text" class="form-control" ng-disabled="true" datepicker-popup="{{format}}" ng-model="startDate" is-open="stateOpened" close-text="Close"> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="open($event, \'start\')"><i class="glyphicon glyphicon-calendar"></i></button></span></p></div><div class="col-md-6"><p class="input-group"><input type="text" class="form-control" ng-disabled="true" datepicker-popup="{{format}}" ng-model="endDate" is-open="endOpened" close-text="Close"> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="open($event, \'end\')"><i class="glyphicon glyphicon-calendar"></i></button></span></p></div><button type="button" class="btn btn-primary col-md-4" ng-click="checkDates()">Confirm Start and End Dates</button><div class="col-md-2"></div><div class="col-md-2">Upload Record:</div><input type="file" class="col-md-4" on-read-file="loadFromFile($fileContent)"></div><div ng-show="validDates"><button type="button" class="btn btn-primary" ng-click="downloadFile()">Download</button><accordion close-others="false"><accordion-group is-open="dayStatus.open" ng-repeat="dayRecord in dayRecords"><accordion-heading><div class="row"><span class="col-md-2">{{ dayRecord.name }}</span> <span class="col-md-3">Income: {{ dayRecord | dayTotalIncome:this }}</span> <span class="col-md-3">Expense: {{ dayRecord | dayTotalExpense:this }}</span> <span class="col-md-3">Balance: {{ dayRecord | dayTotalBalance:this }}</span> <i class="col-md-1 pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': dayStatus.open, \'glyphicon-chevron-right\': !dayStatus.open}"></i></div></accordion-heading><div class="col-md-12 row"><div class="col-md-12"><accordion close-others="false"><accordion-group is-open="groupStatus.open" ng-repeat="group in dayRecord.groups"><accordion-heading><div class="row"><span class="col-md-2">{{ group.name }}</span> <span class="col-md-3">Income: {{ group | groupTotalIncome:this }}</span> <span class="col-md-3">Expense: {{ group | groupTotalExpense:this }}</span> <span class="col-md-3">Balance: {{ group | groupTotalBalance:this }}</span> <i class="col-md-1 pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': groupStatus.open, \'glyphicon-chevron-right\': !groupStatus.open}"></i></div></accordion-heading><div class="col-md-12 row"><div class="col-md-2"></div><div class="col-md-4 row"><div class="col-md-12 row" ng-repeat="item in group.incomeItems"><div class="input-group col-md-12 row"><span class="input-group-addon"><input type="checkbox" ng-model="item.checked"></span> <input type="text" placeholder="Item Name" class="form-control" ng-model="item.name"></div><div class="input-group col-md-12 row"><label class="col-md-4">Price:</label> <input type="text" placeholder="0.00" class="col-md-8" ng-model="item.price"></div></div><div class="col-md-12 glyphicon glyphicon-plus" ng-click="addIncomeItem(group)"></div></div><div class="col-md-4 row"><div class="col-md-12 row" ng-repeat="item in group.expenseItems"><div class="input-group col-md-12 row"><span class="input-group-addon"><input type="checkbox" ng-model="item.checked"></span> <input type="text" placeholder="Item Name" class="form-control" ng-model="item.name"></div><div class="input-group col-md-12 row"><label class="col-md-4">Price:</label> <input type="text" placeholder="0.00" class="col-md-8" ng-model="item.price"></div></div><div class="col-md-12 glyphicon glyphicon-plus" ng-click="addExpenseItem(group)"></div></div><div class="col-md-3 row"></div></div></accordion-group></accordion></div></div></accordion-group></accordion></div></div>'),e.put("app/demo2/demo.html",'<div class="container"><div class="row"><button type="button" class="btn btn-primary col-md-6" ng-click="downloadFile()">Download Record</button><div class="col-md-2">Upload Record:</div><input type="file" class="col-md-4" value="Upload Records" on-read-file="loadFromFile($fileContent)"></div><br><tabset><tab heading="Items"><div class="row" ng-repeat="itemID in items.ids"><div class="col-md-3"><p class="input-group"><input type="text" class="form-control" ng-disabled="true" datepicker-popup="{{format}}" ng-model="items[itemID].date" ng-change="updateLastDateInput(itemID)" is-open="datePickerOpenedItems[itemID]" close-text="Close"> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="open($event, itemID)"><i class="glyphicon glyphicon-calendar"></i></button></span></p></div><div class="col-md-3"><p class="input-group"><label class="col-md-4">Item Name:</label> <input type="text" placeholder="Item Name" ng-model="items[itemID].name"></p></div><div class="col-md-2"><div class="input-group"><label class="col-md-4">Price:</label> <input type="text" placeholder="0.00" class="col-md-8" ng-keydown="keyDown($event, items.ids.length)" ng-model="items[itemID].price"></div></div><div class="col-md-3 row"><div class="col-md-6"><select class="form-control" ng-model="items[itemID].itemType" ng-options="opt for opt in statement.itemTypes" ng-change="updateLastItemTypeInput(itemID)"></select></div><div class="col-md-6"><select class="form-control" ng-model="items[itemID].itemGroup" ng-options="opt for opt in statement.itemGroups" ng-change="updateLastItemGroupInput(itemID)"></select></div></div><div class="col-md-1 row"><button type="button" class="btn btn-danger" ng-click="deleteItem(itemID)" confirm="Are you sure?">Delete Item</button></div></div><br><div class="col-md-12 row"><button type="button" class="btn btn-info col-md-12" ng-click="addItem()" confirm="Are you sure?">点击按钮 或 输入价格后同时按下 Alt+A 添加新条目</button></div></tab><tab heading="Statement"><accordion close-others="false"><accordion-group is-open="dayStatus.open" ng-repeat="day in items | itemDays"><accordion-heading><div class="row"><span class="col-md-2">{{ day }}</span> <span class="col-md-3">Income: {{ items | dayTotal:day:"Income":this }}</span> <span class="col-md-3">Expense: {{ items | dayTotal:day:"Expense":this }}</span> <span class="col-md-3">Other: {{ items | dayTotal:day:"Other":this }}</span> <i class="col-md-1 pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': dayStatus.open, \'glyphicon-chevron-right\': !dayStatus.open}"></i></div></accordion-heading><div class="col-md-12 row"><accordion close-others="false"><accordion-group is-open="groupStatus.open" ng-repeat="group in statement.itemGroups"><accordion-heading><div class="row"><span class="col-md-2">{{ group }}</span> <span class="col-md-3">Income: {{ items | groupTotal:day:group:"Income":this }}</span> <span class="col-md-3">Expense: {{ items | groupTotal:day:group:"Expense":this }}</span> <span class="col-md-3">Other: {{ items | groupTotal:day:group:"Other":this }}</span> <i class="col-md-1 pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': groupStatus.open, \'glyphicon-chevron-right\': !groupStatus.open}"></i></div></accordion-heading><div class="col-md-12 row"><div class="col-md-2"></div><div class="col-md-3 row"><div class="col-md-12 row" ng-repeat="item in items | groupItem:day:group:\'Income\'"><div class="input-group col-md-12 row"><span class="input-group-addon"><input type="checkbox" ng-checked="!uncheckedItems[item.id]" ng-click="toggleItemCheck(item.id)"></span> <input type="text" placeholder="Item Name" class="form-control" ng-model="item.name"></div><div class="input-group col-md-12 row"><label class="col-md-4">Price:</label> <input type="text" placeholder="0.00" class="col-md-8" ng-model="item.price"></div></div></div><div class="col-md-3 row"><div class="col-md-12 row" ng-repeat="item in items | groupItem:day:group:\'Expense\'"><div class="input-group col-md-12 row"><span class="input-group-addon"><input type="checkbox" ng-checked="!uncheckedItems[item.id]" ng-click="toggleItemCheck(item.id)"></span> <input type="text" placeholder="Item Name" class="form-control" ng-model="item.name"></div><div class="input-group col-md-12 row"><label class="col-md-4">Price:</label> <input type="text" placeholder="0.00" class="col-md-8" ng-model="item.price"></div></div></div><div class="col-md-2 row"></div><div class="col-md-3 row"><div class="col-md-12 row" ng-repeat="item in items | groupItem:day:group:\'Other\'"><div class="input-group col-md-12 row"><span class="input-group-addon"><input type="checkbox" ng-checked="!uncheckedItems[item.id]" ng-click="toggleItemCheck(item.id)"></span> <input type="text" placeholder="Item Name" class="form-control" ng-model="item.name"></div><div class="input-group col-md-12 row"><label class="col-md-4">Price:</label> <input type="text" placeholder="0.00" class="col-md-8" ng-model="item.price"></div></div></div></div></accordion-group></accordion></div></accordion-group></accordion></tab><tab heading="Weekly Statement"><accordion close-others="false"><accordion-group is-open="weeklyStatementStatus.open" ng-repeat="week in items | weeksOfItems"><accordion-heading><div class="row"><span class="col-md-12">{{ week | weekDateRange }}</span></div><div class="row"><span class="col-md-4">Income {{ items | weekTotal:week:"Income":this }}</span> <span class="col-md-4">Expense {{ items | weekTotal:week:"Expense":this }}</span> <span class="col-md-4">Other {{ items | weekTotal:week:"Other":this }}</span></div></accordion-heading><div class="col-md-12 row"><tabset><tab heading="Income"><accordion close-others="false"><accordion-group is-open="weeklyDayIncomeStatus.open" ng-repeat="day in items | itemWeekDays:week"><accordion-heading><div class="row"><span class="col-md-12">{{ day }}: {{ items | dayTotal:day:"Income":this }}</span> <i class="col-md-1 pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': dayStatus.open, \'glyphicon-chevron-right\': !dayStatus.open}"></i></div></accordion-heading><div class="col-md-12 row"><accordion close-others="false"><accordion-group is-open="weeklyDayIncomeGroupStatus.open" ng-repeat="group in statement.itemGroups"><accordion-heading><div class="row"><span class="col-md-12">{{ group }}: {{ items | groupTotal:day:group:"Income":this }}</span> <i class="col-md-1 pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': groupStatus.open, \'glyphicon-chevron-right\': !groupStatus.open}"></i></div></accordion-heading><div class="col-md-12 row" ng-repeat="item in items | groupItem:day:group:\'Income\'"><div class="input-group col-md-12 row"><span class="input-group-addon"><input type="checkbox" ng-checked="!uncheckedItems[item.id]" ng-click="toggleItemCheck(item.id)"></span> <input type="text" placeholder="Item Name" class="form-control" ng-model="item.name"></div><div class="input-group col-md-12 row"><label class="col-md-4">Price:</label> <input type="text" placeholder="0.00" class="col-md-8" ng-model="item.price"></div></div></accordion-group></accordion></div></accordion-group></accordion></tab><tab heading="Expense"><div class="col-md-12 row" ng-repeat="item in items | weekItems:week:\'Expense\'"><div class="input-group col-md-12 row"><span class="input-group-addon"><input type="checkbox" ng-checked="!uncheckedItems[item.id]" ng-click="toggleItemCheck(item.id)"></span><div class="col-md-3">{{ items[item.id].date }}</div><input type="text" placeholder="Item Name" class="form-control" ng-model="item.name"><div class="input-group col-md-12 row"><label class="col-md-4">Price:</label> <input type="text" placeholder="0.00" class="col-md-8" ng-model="item.price"></div></div></div></tab><tab heading="Other"><div class="col-md-12 row" ng-repeat="item in items | weekItems:week:\'Other\'"><div class="input-group col-md-12 row"><span class="input-group-addon"><input type="checkbox" ng-checked="!uncheckedItems[item.id]" ng-click="toggleItemCheck(item.id)"></span><div class="col-md-3">{{ items[item.id].date }}</div><input type="text" placeholder="Item Name" class="form-control" ng-model="item.name"><div class="input-group col-md-12 row"><label class="col-md-4">Price:</label> <input type="text" placeholder="0.00" class="col-md-8" ng-model="item.price"></div></div></div></tab></tabset></div></accordion-group></accordion></tab></tabset></div>'),e.put("app/main/main.html",'<div class="container"><a ui-sref="demo1">Demo 1</a><br><a ui-sref="demo2">Demo 2</a></div>')}]);